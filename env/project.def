Bootstrap: docker
From: ubuntu:22.04

%post
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y --no-install-recommends \
        build-essential openmpi-bin libopenmpi-dev \
        libomp-dev ca-certificates wget git perf \
        && rm -rf /var/lib/apt/lists/*
    mkdir -p /opt/hpc-app
    echo "Container built for Magic Castle fallback runs" > /opt/hpc-app/README

%environment
    export OMP_NUM_THREADS=${OMP_NUM_THREADS:-4}
    export PATH=/opt/hpc-app:$PATH

%labels
    Author IE-HPC-Group
    Application miniweather_hpc
    Description "MPI + OpenMP 2D stencil CPU build for Alliance/EESSI"
    Build-date `date`
